<div class="reports-container">
    <!-- Header Section -->
    <div class="page-header">
        <div class="header-content">
            <div class="header-title">
                <h1 class="page-title">Reports</h1>
                <p class="page-description">Generate and view various reports for your brand</p>
            </div>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
        <div class="filters-card">
            <div class="filters-header">
                <h3 class="filters-title">Report Filters</h3>
            </div>
            <div class="filters-content">
                <div class="filters-row">
                    <div class="filter-group">
                        <label for="assignmentFilter" class="filter-label">Assignment</label>
                        <div class="custom-select assignment-dropdown" [class.open]="isAssignmentDropdownOpen"
                            (click)="toggleAssignmentDropdown($event)">
                            <div class="select-display">
                                <span class="select-text" [class.placeholder]="selectedAssignments.length === 0">
                                    {{ getSelectedAssignmentsText() }}
                                </span>
                                <span class="select-arrow">
                                    <span class="material-icons">keyboard_arrow_down</span>
                                </span>
                            </div>
                            <div class="select-dropdown" *ngIf="isAssignmentDropdownOpen">
                                <div class="dropdown-option" *ngFor="let assignment of assignments"
                                    (click)="toggleAssignmentSelection(assignment, $event)">
                                    <div class="checkbox-wrapper">
                                        <input type="checkbox" [checked]="isAssignmentSelected(assignment)"
                                            (click)="$event.stopPropagation()"
                                            (change)="toggleAssignmentSelection(assignment, $event)">
                                        <span class="checkbox-label">{{ assignment.name }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-group">
                        <label for="statusFilter" class="filter-label">Status</label>
                        <div class="custom-select status-dropdown" [class.open]="isStatusDropdownOpen"
                            (click)="toggleStatusDropdown($event)">
                            <div class="select-display">
                                <span class="select-text" [class.placeholder]="selectedStatuses.length === 0">
                                    {{ getSelectedStatusesText() }}
                                </span>
                                <span class="select-arrow">
                                    <span class="material-icons">keyboard_arrow_down</span>
                                </span>
                            </div>
                            <div class="select-dropdown" *ngIf="isStatusDropdownOpen">
                                <div class="dropdown-option" *ngFor="let status of statuses"
                                    (click)="toggleStatusSelection(status, $event)">
                                    <div class="checkbox-wrapper">
                                        <input type="checkbox" [checked]="isStatusSelected(status)"
                                            (click)="$event.stopPropagation()"
                                            (change)="toggleStatusSelection(status, $event)">
                                        <span class="checkbox-label">{{ status }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-group">
                        <label for="dateRange" class="filter-label">Date Range</label>
                        <div class="date-range-picker">
                            <div class="date-range-display" (click)="toggleDatePicker()">
                                <span class="date-range-text" [class.placeholder]="!startDate && !endDate">
                                    {{ getDateRangeText() }}
                                </span>
                                <span class="date-range-icon">
                                    <span class="material-icons">calendar_today</span>
                                </span>
                            </div>

                            <div class="date-picker-dropdown" *ngIf="isDatePickerOpen">
                                <div class="date-picker-header">
                                    <button class="date-nav-btn" (click)="previousMonth()">
                                        <span class="material-icons">chevron_left</span>
                                    </button>
                                    <span class="current-month">{{ getCurrentMonthYear() }}</span>
                                    <button class="date-nav-btn" (click)="nextMonth()">
                                        <span class="material-icons">chevron_right</span>
                                    </button>
                                </div>

                                <div class="calendar-grid">
                                    <div class="calendar-weekdays">
                                        <span *ngFor="let day of weekdays">{{ day }}</span>
                                    </div>
                                    <div class="calendar-days">
                                        <span *ngFor="let day of calendarDays" class="calendar-day"
                                            [class.other-month]="!day.currentMonth"
                                            [class.selected]="isDateSelected(day.date)"
                                            [class.in-range]="isDateInRange(day.date)"
                                            [class.range-start]="isRangeStart(day.date)"
                                            [class.range-end]="isRangeEnd(day.date)" (click)="selectDate(day.date)">
                                            {{ day.dayNumber }}
                                        </span>
                                    </div>
                                </div>

                                <div class="date-picker-actions">
                                    <button class="btn btn-secondary" (click)="clearDateRange()">Clear</button>
                                    <button class="btn btn-primary" (click)="applyDateRange()">Apply</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-actions">
                        <button class="btn btn-primary" (click)="search()" [disabled]="loading">
                            <l-tail-chase *ngIf="loading" size="sm" speed="1.5" color="white"></l-tail-chase>
                            Search
                        </button>
                        <button class="btn btn-secondary" (click)="clearSearch()" *ngIf="filtersApplied">
                            Clear
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <div class="results-section" *ngIf="filtersApplied">
        <div class="results-card">
            <div class="results-header">
                <h3 class="results-title">Shop Outlets Results</h3>
                <div class="results-summary">
                    <button class="btn btn-secondary export-btn" (click)="exportToExcel()"
                        [disabled]="loading || stores.length === 0">
                        <span *ngIf="exporting" class="loading-spinner"></span>
                        <span *ngIf="!exporting">Export to Excel</span>
                    </button>
                    <button class="btn btn-secondary pdf-export-btn" (click)="exportToPdf()"
                        [disabled]="loading || stores.length === 0">
                        <span *ngIf="exportingPdf" class="loading-spinner"></span>
                        <span *ngIf="!exportingPdf">Export to PDF</span>
                    </button>
                    <span class="total-count">Total: {{ totalCount }} Outlets</span>
                </div>
            </div>

            <!-- Loading State -->
            <div class="loading-state" *ngIf="loading">
                <l-tail-chase size="lg" speed="1.5" color="primary"></l-tail-chase>
                <p>Loading stores...</p>
            </div>

            <!-- Results Grid -->
            <div class="results-grid" *ngIf="!loading && stores.length > 0">
                <div class="scroll-hint">
                    <i class="scroll-icon">â†”</i>
                    <span>Scroll horizontally to view all columns</span>
                </div>
                <div class="table-container">
                    <table class="stores-table">
                        <thead>
                            <tr>
                                <th>Assignment Name</th>
                                <th>RETAILER/OUTLET NAME</th>
                                <th>SAP ID</th>
                                <th>Overall Status</th>
                                <th>Vendor Status</th>
                                <th>LOCATION</th>
                                <th>GPS LOCATION</th>
                                <th>MOBILE NUMBER</th>
                                <th>BRANDING TYPE</th>
                                <th>HEIGHT(FT)</th>
                                <th>WIDTH(FT)</th>
                                <th>HEIGHT(IN)</th>
                                <th>WIDTH(IN)</th>
                                <th>QTY</th>
                                <th>TOTAL SQ FT. SIZE</th>
                                <th>EACH RATE</th>
                                <th>GROSS AMOUNT</th>
                                <th>GST</th>
                                <th>NET AMOUNT</th>
                            </tr>
                        </thead>
                        <tbody>
                            <ng-container *ngFor="let store of stores">
                                <!-- Board Row -->
                                <tr *ngIf="store.boardWidth && store.boardHeight">
                                    <td>{{ store.assignmentName }}</td>
                                    <td>
                                        <div class="store-info">
                                            <div class="store-name">{{ store.storeName }}</div>
                                        </div>
                                    </td>
                                    <td>{{ store.sapId }}</td>
                                    <td>
                                        <span class="status-badge" [class]="getStatusClass(store.overallStatus)">
                                            {{ store.overallStatus }}
                                        </span>
                                    </td>
                                    <td>{{ store.vendorWorkStatus || '-' }}</td>
                                    <td>{{ (store.storeAddress || '') + ' ' + (store.regionName || '') | trim }}</td>
                                    <td>
                                        <a *ngIf="store.gpsLocation" [href]="getGoogleMapsUrl(store.gpsLocation)"
                                            target="_blank" class="gps-link">
                                            {{ getGpsDisplayText(store.gpsLocation) }}
                                        </a>
                                        <span *ngIf="!store.gpsLocation">-</span>
                                    </td>
                                    <td>{{ store.storePhoneNumber || '-' }}</td>
                                    <td>{{ store.boardName || 'Board' }}</td>
                                    <td>{{ getBoardHeightFt(store.boardHeight) }}</td>
                                    <td>{{ getBoardWidthFt(store.boardWidth) }}</td>
                                    <td>{{ store.boardHeight || 0 }}</td>
                                    <td>{{ store.boardWidth || 0 }}</td>
                                    <td>1</td>
                                    <td>{{ getBoardArea(store.boardWidth, store.boardHeight) }}</td>
                                    <td>{{ store.boardCost || 0 | number:'1.2-2' }}</td>
                                    <td>{{ getBoardGrossAmount(store.boardWidth, store.boardHeight, store.boardCost) |
                                        number:'1.2-2' }}</td>
                                    <td>{{ getBoardGst(store.boardWidth, store.boardHeight, store.boardCost) |
                                        number:'1.2-2' }}</td>
                                    <td>{{ getBoardNetAmount(store.boardWidth, store.boardHeight, store.boardCost) |
                                        number:'1.2-2' }}</td>
                                </tr>

                                <!-- Pole Row -->
                                <tr *ngIf="store.poleQuantity && store.poleWidth && store.poleHeight" class="pole-row">
                                    <td>{{ store.assignmentName }}</td>
                                    <td>
                                        <div class="store-info">
                                            <div class="store-name">{{ store.storeName }}</div>
                                        </div>
                                    </td>
                                    <td>{{ store.sapId }}</td>
                                    <td>
                                        <span class="status-badge" [class]="getStatusClass(store.overallStatus)">
                                            {{ store.overallStatus }}
                                        </span>
                                    </td>
                                    <td>{{ store.vendorWorkStatus || '-' }}</td>
                                    <td>{{ (store.storeAddress || '') + ' ' + (store.regionName || '') | trim }}</td>
                                    <td>
                                        <a *ngIf="store.gpsLocation" [href]="getGoogleMapsUrl(store.gpsLocation)"
                                            target="_blank" class="gps-link">
                                            {{ getGpsDisplayText(store.gpsLocation) }}
                                        </a>
                                        <span *ngIf="!store.gpsLocation">-</span>
                                    </td>
                                    <td>{{ store.storePhoneNumber || '-' }}</td>
                                    <td>Pole</td>
                                    <td>{{ getPoleHeightFt(store.poleHeight) }}</td>
                                    <td>{{ getPoleWidthFt(store.poleWidth) }}</td>
                                    <td>{{ store.poleHeight || 0 }}</td>
                                    <td>{{ store.poleWidth || 0 }}</td>
                                    <td>{{ store.poleQuantity || 0 }}</td>
                                    <td>{{ getPoleArea(store.poleWidth, store.poleHeight, store.poleQuantity) }}</td>
                                    <td>{{ store.poleCost || 0 | number:'1.2-2' }}</td>
                                    <td>{{ getPoleGrossAmount(store.poleWidth, store.poleHeight, store.poleQuantity,
                                        store.poleCost) | number:'1.2-2' }}</td>
                                    <td>{{ getPoleGst(store.poleWidth, store.poleHeight, store.poleQuantity,
                                        store.poleCost) | number:'1.2-2' }}</td>
                                    <td>{{ getPoleNetAmount(store.poleWidth, store.poleHeight, store.poleQuantity,
                                        store.poleCost) | number:'1.2-2' }}</td>
                                </tr>

                                <!-- Default Row (if neither board nor pole exists) -->
                                <tr
                                    *ngIf="(!store.boardWidth || !store.boardHeight) && (!store.poleQuantity || !store.poleWidth || !store.poleHeight)">
                                    <td>{{ store.assignmentName }}</td>
                                    <td>
                                        <div class="store-info">
                                            <div class="store-name">{{ store.storeName }}</div>
                                        </div>
                                    </td>
                                    <td>{{ store.sapId }}</td>
                                    <td>
                                        <span class="status-badge" [class]="getStatusClass(store.overallStatus)">
                                            {{ store.overallStatus }}
                                        </span>
                                    </td>
                                    <td>{{ store.vendorWorkStatus || '-' }}</td>
                                    <td>{{ (store.storeAddress || '') + ' ' + (store.regionName || '') | trim }}</td>
                                    <td>
                                        <a *ngIf="store.gpsLocation" [href]="getGoogleMapsUrl(store.gpsLocation)"
                                            target="_blank" class="gps-link">
                                            {{ getGpsDisplayText(store.gpsLocation) }}
                                        </a>
                                        <span *ngIf="!store.gpsLocation">-</span>
                                    </td>
                                    <td>{{ store.storePhoneNumber || '-' }}</td>
                                    <td>{{ store.boardName || 'Board' }}</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0</td>
                                </tr>
                            </ng-container>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination" *ngIf="totalPages > 1">
                    <button class="pagination-btn" [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
                        Previous
                    </button>

                    <div class="page-numbers">
                        <span class="page-info">{{ currentPage }} of {{ totalPages }}</span>
                    </div>

                    <button class="pagination-btn" [disabled]="currentPage === totalPages"
                        (click)="changePage(currentPage + 1)">
                        Next
                    </button>
                </div>
            </div>

            <!-- No Results -->
            <div class="no-results" *ngIf="!loading && stores.length === 0">
                <p>No stores found matching your criteria.</p>
                <p>Try adjusting your filters or search parameters.</p>
            </div>
        </div>
    </div>
</div>