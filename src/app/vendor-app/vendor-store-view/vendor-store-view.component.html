<app-vendor-header></app-vendor-header>

<!-- Mobile Back Button -->
<button class="mobile-back-btn" (click)="goBack()" type="button">
    <span class="material-icons">arrow_back</span>
    Back
</button>

<div class="store-view-container">
    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
        <l-tail-chase size="40" speed="1.75" color="#006fcf"></l-tail-chase>
        <p>Loading store details...</p>
    </div>

    <!-- Store Details -->
    <div class="store-details-container" *ngIf="!loading && storeAssignment">
        <!-- Header -->
        <!-- <div class="view-header">
            <div class="header-content">
                <button class="back-btn" (click)="goBack()" type="button">
                    <span class="material-icons">arrow_back</span>
                    Back to Assignment
                </button>
                <div class="header-title">
                    <h1>Store Details</h1>
                    <p>{{ storeAssignment.storeName }}</p>
                </div>
            </div>
        </div> -->

        <!-- Store Info -->
        <div class="store-info">
            <button type="button" class="close-btn" (click)="goBack()" title="Close">
                <span class="material-icons">close</span>
            </button>
            <div class="info-row">
                <div class="info-item">
                    <label>Store Name</label>
                    <span>{{ storeAssignment.storeName }}</span>
                </div>
                <div class="info-item">
                    <label>Address</label>
                    <span>{{ storeAssignment.storeAddress }}</span>
                </div>
                <div class="info-item">
                    <label>Current Status</label>
                    <span class="status-badge" [class]="'status-' + getStatusColor(storeAssignment.vendorWorkStatus)">
                        {{ storeAssignment.vendorWorkStatus }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Board Details Section -->
        <div class="board-details-section"
            *ngIf="(storeAssignment.boardId || (storeAssignment.boardWidth && storeAssignment.boardHeight)) || (storeAssignment.poleQuantity && storeAssignment.poleQuantity > 0)">
            <h3>{{ (storeAssignment.poleQuantity && storeAssignment.poleQuantity > 0) ? 'Board & Pole Details' : 'Board
                Details' }}</h3>
            <div class="board-details-grid"
                [class.single-column]="!(storeAssignment.poleQuantity && storeAssignment.poleQuantity > 0)">
                <!-- Board Information -->
                <div class="board-info"
                    *ngIf="storeAssignment.boardId || (storeAssignment.boardWidth && storeAssignment.boardHeight)">
                    <div class="detail-item">
                        <label>Board Type</label>
                        <div class="detail-value">
                            <span
                                *ngIf="storeAssignment.boardName && storeAssignment.boardWidth && storeAssignment.boardHeight">
                                {{ storeAssignment.boardName }} ({{ storeAssignment.boardWidth }}" × {{
                                storeAssignment.boardHeight }}")<span class="cost-display"
                                    *ngIf="storeAssignment.boardCost" title="cost per sq ft"> ₹{{
                                    storeAssignment.boardCost }}</span>
                            </span>
                            <span
                                *ngIf="storeAssignment.boardName && (!storeAssignment.boardWidth || !storeAssignment.boardHeight)">
                                {{ storeAssignment.boardName }}<span class="cost-display"
                                    *ngIf="storeAssignment.boardCost" title="cost per sq ft"> ₹{{
                                    storeAssignment.boardCost }}</span>
                            </span>
                            <span
                                *ngIf="!storeAssignment.boardName && storeAssignment.boardWidth && storeAssignment.boardHeight">
                                {{ storeAssignment.boardWidth }}" × {{ storeAssignment.boardHeight }}"<span
                                    class="cost-display" *ngIf="storeAssignment.boardCost" title="cost per sq ft"> ₹{{
                                    storeAssignment.boardCost }}</span>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Pole Information -->
                <div class="pole-info" *ngIf="storeAssignment.poleQuantity && storeAssignment.poleQuantity > 0">
                    <div class="detail-item">
                        <label>Pole(s)</label>
                        <div class="detail-value">
                            <span *ngIf="storeAssignment.poleWidth && storeAssignment.poleHeight">
                                {{ storeAssignment.poleQuantity }} ({{ storeAssignment.poleWidth }}" × {{
                                storeAssignment.poleHeight }}")<span class="cost-display"
                                    *ngIf="storeAssignment.poleCost" title="cost per sq ft"> ₹{{
                                    storeAssignment.poleCost }}</span>
                            </span>
                            <span *ngIf="!storeAssignment.poleWidth || !storeAssignment.poleHeight">
                                {{ storeAssignment.poleQuantity }}<span class="cost-display"
                                    *ngIf="storeAssignment.poleCost" title="cost per sq ft"> ₹{{
                                    storeAssignment.poleCost }}</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Images Section -->
        <div class="images-section">
            <h3>Store Images</h3>

            <!-- Banner Image -->
            <div class="image-section" *ngIf="storeAssignment.bannerImageUrl">
                <h4>Banner Image</h4>
                <div class="image-container">
                    <div class="image-loading" *ngIf="!bannerImageLoaded">
                        <l-tail-chase size="40" speed="1" color="#006fcf"></l-tail-chase>
                    </div>
                    <img [src]="storeAssignment.bannerImageUrl" alt="Banner Image" loading="lazy"
                        (load)="onBannerImageLoad()" (error)="onBannerImageError()" [class.hidden]="!bannerImageLoaded"
                        [class.loaded]="bannerImageLoaded">
                </div>
            </div>

            <!-- Before and After Execution Images -->
            <!-- Single centered image when only before execution is present -->
            <div class="single-execution-image"
                *ngIf="storeAssignment.beforeExecutionImageUrl && !storeAssignment.afterExecutionImageUrl">
                <h4>Before Execution</h4>
                <div class="execution-image-container">
                    <div class="image-loading" *ngIf="!beforeImageLoaded">
                        <l-tail-chase size="40" speed="1" color="#006fcf"></l-tail-chase>
                    </div>
                    <img [src]="storeAssignment.beforeExecutionImageUrl" alt="Before Execution Image" loading="lazy"
                        (load)="onBeforeImageLoad()" (error)="onBeforeImageError()" [class.hidden]="!beforeImageLoaded"
                        [class.loaded]="beforeImageLoaded">
                </div>
            </div>

            <!-- 2x2 Grid when both images are present -->
            <div class="execution-images-grid"
                *ngIf="storeAssignment.beforeExecutionImageUrl && storeAssignment.afterExecutionImageUrl">
                <!-- Before Execution Image -->
                <div class="execution-image-section">
                    <h4>Before Execution</h4>
                    <div class="execution-image-container">
                        <div class="image-loading" *ngIf="!beforeImageLoaded">
                            <l-tail-chase size="40" speed="1" color="#006fcf"></l-tail-chase>
                        </div>
                        <img [src]="storeAssignment.beforeExecutionImageUrl" alt="Before Execution Image" loading="lazy"
                            (load)="onBeforeImageLoad()" (error)="onBeforeImageError()"
                            [class.hidden]="!beforeImageLoaded" [class.loaded]="beforeImageLoaded">
                    </div>
                </div>

                <!-- After Execution Image -->
                <div class="execution-image-section">
                    <h4>After Execution</h4>
                    <div class="execution-image-container">
                        <div class="image-loading" *ngIf="!afterImageLoaded">
                            <l-tail-chase size="40" speed="1" color="#006fcf"></l-tail-chase>
                        </div>
                        <img [src]="storeAssignment.afterExecutionImageUrl" alt="After Execution Image" loading="lazy"
                            (load)="onAfterImageLoad()" (error)="onAfterImageError()" [class.hidden]="!afterImageLoaded"
                            [class.loaded]="afterImageLoaded">
                    </div>
                </div>
            </div>

            <!-- Single centered image when only after execution is present -->
            <div class="single-execution-image"
                *ngIf="!storeAssignment.beforeExecutionImageUrl && storeAssignment.afterExecutionImageUrl">
                <h4>After Execution</h4>
                <div class="execution-image-container">
                    <div class="image-loading" *ngIf="!afterImageLoaded">
                        <l-tail-chase size="40" speed="1" color="#006fcf"></l-tail-chase>
                    </div>
                    <img [src]="storeAssignment.afterExecutionImageUrl" alt="After Execution Image" loading="lazy"
                        (load)="onAfterImageLoad()" (error)="onAfterImageError()" [class.hidden]="!afterImageLoaded"
                        [class.loaded]="afterImageLoaded">
                </div>
            </div>

            <!-- No Images Message -->
            <div class="no-images"
                *ngIf="!storeAssignment.bannerImageUrl && !storeAssignment.beforeExecutionImageUrl && !storeAssignment.afterExecutionImageUrl">
                <span class="material-icons">image</span>
                <p>No images uploaded yet</p>
                <!-- <button class="btn btn-primary" (click)="editStore()">
                    <span class="material-icons">add_photo_alternate</span>
                    Upload Images
                </button> -->
            </div>
        </div>

        <!-- GPS Location Section -->
        <div class="gps-location-section" *ngIf="storeAssignment.gpsLocation">
            <h3>GPS Location</h3>
            <div class="gps-location-container">
                <div class="gps-display" (click)="openGoogleMaps(storeAssignment.gpsLocation)"
                    [class.clickable]="getGpsCoordinates(storeAssignment.gpsLocation)">
                    <div class="gps-info">
                        <div class="gps-address">{{ getGpsAddress(storeAssignment.gpsLocation) }}</div>
                        <div class="gps-coords" *ngIf="getGpsCoordinates(storeAssignment.gpsLocation)">
                            📍 {{ formatCoordinates(getGpsCoordinates(storeAssignment.gpsLocation)) }}
                        </div>
                        <!-- <div class="gps-hint" *ngIf="getGpsCoordinates(storeAssignment.gpsLocation)">
                            <span class="material-icons">open_in_new</span>
                            <span>Click to open in Google Maps</span>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="notes-section" *ngIf="storeAssignment.vendorNotes">
            <h3>Notes</h3>
            <div class="notes-content">
                <p>{{ storeAssignment.vendorNotes }}</p>
            </div>
        </div>

        <!-- Completion Actions -->
        <div class="completion-actions" *ngIf="canMarkAsComplete() && storeAssignment.vendorWorkStatus !== 'Completed'">
            <div class="completion-info">
                <!-- <span class="material-icons">check_circle</span> -->
                <div class="completion-text">
                    <h4>Ready to Complete</h4>
                    <p>All required images have been uploaded. You can now mark this store as complete.</p>
                </div>
            </div>
            <div class="actions-buttons">
                <button class="edit-store-btn" (click)="editStore()" title="Edit Store">
                    <span class="material-icons">edit</span>
                    Edit Store
                </button>
                <button class="btn btn-success" (click)="markAsComplete()">
                    <span class="material-icons">check_circle</span>
                    Mark as Complete
                </button>
            </div>
        </div>

        <!-- Edit Store Button for Non-Completed Stores -->
        <div class="edit-store-section"
            *ngIf="storeAssignment.vendorWorkStatus !== 'Completed' && !canMarkAsComplete()">
            <div class="actions-buttons">
                <button class="edit-store-btn" (click)="editStore()" title="Edit Store">
                    <span class="material-icons">edit</span>
                    Edit Store
                </button>
            </div>
        </div>

        <!-- Completed Status -->
        <div class="completed-status" *ngIf="storeAssignment.vendorWorkStatus === 'Completed'">
            <div class="completion-badge">
                <span class="material-icons">verified</span>
                <div class="completion-text">
                    <h4>Store Completed</h4>
                    <p>This store has been successfully completed on {{ storeAssignment.completedDate | date:'medium' }}
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>