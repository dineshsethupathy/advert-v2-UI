<!-- Mobile Back Button -->
<!-- <button class="mobile-back-btn" (click)="goBack()" type="button">
    <span class="material-icons">arrow_back</span>
    Back
</button> -->

<app-vendor-header></app-vendor-header>

<div class="store-edit-container">
    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
        <l-tail-chase size="40" speed="1.75" color="#006fcf"></l-tail-chase>
        <p>Loading store form...</p>
    </div>

    <!-- Store Form -->
    <div class="store-form-container" *ngIf="!loading && storeAssignment">
        <!-- Header -->
        <!-- <div class="form-header">
            <div class="header-content">
                <div class="header-title">
                    <h1>Store Form</h1>
                    <p>{{ storeAssignment.storeName }}</p>
                </div>
            </div>
        </div> -->

        <!-- Store Info -->
        <div class="store-info">
            <button type="button" class="close-btn" (click)="goBack()" title="Close">
                <span class="material-icons">close</span>
            </button>
            <div class="info-grid">
                <div class="info-item">
                    <label>Store Name</label>
                    <span>{{ storeAssignment.storeName }}</span>
                </div>
                <div class="info-item">
                    <label>Address</label>
                    <span>{{ storeAssignment.storeAddress }}</span>
                </div>
                <div class="info-item">
                    <label>Current Status</label>
                    <span class="status-badge" [class]="'status-' + getStatusColor(storeAssignment.vendorWorkStatus)">
                        {{ storeAssignment.vendorWorkStatus }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Form -->
        <form [formGroup]="storeForm" (ngSubmit)="onSubmit()" class="store-form">
            <!-- Board Details -->
            <div class="form-section">
                <h3>Board Details</h3>
                <div class="form-row three-columns">
                    <div class="form-group">
                        <label for="boardId">Board Type *</label>
                        <div class="custom-select" [class.open]="isBoardDropdownOpen" (click)="toggleBoardDropdown()">
                            <div class="select-display">
                                <span class="select-text" [class.placeholder]="!storeForm.get('boardId')?.value">
                                    {{ selectedBoardText }}
                                </span>
                                <span class="select-arrow">
                                    <span class="material-icons">keyboard_arrow_down</span>
                                </span>
                            </div>
                            <div class="select-dropdown" *ngIf="isBoardDropdownOpen">
                                <div class="dropdown-option" *ngFor="let board of boards"
                                    (click)="selectBoard(board.id, $event)"
                                    [class.selected]="storeForm.get('boardId')?.value === board.id">
                                    {{ board.name }}
                                </div>
                            </div>
                        </div>
                        <div class="error-message"
                            *ngIf="storeForm.get('boardId')?.invalid && storeForm.get('boardId')?.touched">
                            <span *ngIf="storeForm.get('boardId')?.errors?.['required']">Board type is required</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="boardWidth">Board Width (inches) *</label>
                        <input type="number" id="boardWidth" formControlName="boardWidth"
                            placeholder="Enter board width" step="0.1" min="1" max="1000">
                        <div class="error-message"
                            *ngIf="storeForm.get('boardWidth')?.invalid && storeForm.get('boardWidth')?.touched">
                            <span *ngIf="storeForm.get('boardWidth')?.errors?.['required']">Board width is
                                required</span>
                            <span *ngIf="storeForm.get('boardWidth')?.errors?.['min']">Board width must be at least 1
                                inch</span>
                            <span *ngIf="storeForm.get('boardWidth')?.errors?.['max']">Board width cannot exceed 1000
                                inches</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="boardHeight">Board Height (inches) *</label>
                        <input type="number" id="boardHeight" formControlName="boardHeight"
                            placeholder="Enter board height" step="0.1" min="1" max="1000">
                        <div class="error-message"
                            *ngIf="storeForm.get('boardHeight')?.invalid && storeForm.get('boardHeight')?.touched">
                            <span *ngIf="storeForm.get('boardHeight')?.errors?.['required']">Board height is
                                required</span>
                            <span *ngIf="storeForm.get('boardHeight')?.errors?.['max']">Board height cannot exceed 1000
                                inches</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="boardCost">Board Cost (₹) *</label>
                        <input type="number" id="boardCost" formControlName="boardCost" placeholder="Enter board cost"
                            step="0.01" min="0.01" max="10000">
                        <div class="error-message"
                            *ngIf="storeForm.get('boardCost')?.invalid && storeForm.get('boardCost')?.touched">
                            <span *ngIf="storeForm.get('boardCost')?.errors?.['required']">Board cost is
                                required</span>
                            <span *ngIf="storeForm.get('boardCost')?.errors?.['min']">Board cost must be at least
                                $0.01</span>
                            <span *ngIf="storeForm.get('boardCost')?.errors?.['max']">Board cost cannot exceed
                                $10,000</span>
                        </div>
                    </div>
                </div>

                <!-- Pole Checkbox and Fields -->
                <div class="pole-container">
                    <div class="pole-row">
                        <div class="pole-checkbox">
                            <label class="checkbox-label">
                                <input type="checkbox" id="hasPole" formControlName="hasPole">
                                <span class="checkmark"></span>
                                Pole
                            </label>
                        </div>
                        <div class="pole-fields" *ngIf="storeForm.get('hasPole')?.value">
                            <input type="number" id="poleQuantity" formControlName="poleQuantity" placeholder="Quantity"
                                step="1" min="1" max="100">
                            <input type="number" id="poleWidth" formControlName="poleWidth" placeholder="Width (inches)"
                                step="0.1" min="0.1" max="100">
                            <input type="number" id="poleHeight" formControlName="poleHeight"
                                placeholder="Height (inches)" step="0.1" min="0.1" max="1000">
                            <input type="number" id="poleCost" formControlName="poleCost" placeholder="Cost (₹)"
                                step="0.01" min="0.01" max="10000">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Banner Image -->
            <div class="form-section">
                <h3>Banner Image</h3>
                <div class="image-upload-container">
                    <div class="image-preview" *ngIf="bannerImagePreview">
                        <img [src]="bannerImagePreview" alt="Banner Image">
                        <button type="button" class="remove-btn" (click)="removeImage('banner')">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    <div class="upload-area" *ngIf="!bannerImagePreview">
                        <input type="file" id="bannerImage" accept="image/*" (change)="onBannerImageSelected($event)"
                            class="file-input">
                        <label for="bannerImage" class="upload-label">
                            <span class="material-icons">cloud_upload</span>
                            <span>Upload Banner Image</span>
                            <!-- <small>JPG, PNG, GIF up to 5MB</small> -->
                        </label>
                    </div>
                </div>
            </div>

            <!-- Before Execution Image -->
            <div class="form-section">
                <h3>Before Execution Image</h3>
                <div class="image-upload-container">
                    <div class="image-preview" *ngIf="beforeExecutionImagePreview">
                        <img [src]="beforeExecutionImagePreview" alt="Before Execution Image">
                        <button type="button" class="remove-btn" (click)="removeImage('before')">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    <div class="upload-area" *ngIf="!beforeExecutionImagePreview">
                        <input type="file" id="beforeExecutionImage" accept="image/*"
                            (change)="onBeforeExecutionImageSelected($event)" class="file-input">
                        <label for="beforeExecutionImage" class="upload-label">
                            <span class="material-icons">cloud_upload</span>
                            <span>Upload Before Execution Image</span>
                            <!-- <small>JPG, PNG, GIF up to 5MB</small> -->
                        </label>
                    </div>
                </div>
            </div>

            <!-- GPS Location -->
            <div class="form-section">
                <h3>GPS Location</h3>
                <div class="gps-location-container">
                    <div *ngIf="!gpsLocation" class="gps-upload-area">
                        <button type="button" class="gps-btn" (click)="openLocationPicker()">
                            <span class="material-icons">my_location</span>
                            <span>Pin Location on Map</span>
                        </button>
                    </div>
                    <div *ngIf="gpsLocation" class="gps-display">
                        <div class="gps-info">
                            <div class="gps-address">{{ gpsLocation.address }}</div>
                            <div class="gps-coords" *ngIf="gpsLocation.coords">
                                📍 {{ formatCoordinates(gpsLocation.coords) }}
                            </div>
                        </div>
                        <div class="gps-actions">
                            <button type="button" class="gps-edit-btn" (click)="openLocationPicker()"
                                title="Edit Location">
                                <span class="material-icons">edit</span>
                            </button>
                            <button type="button" class="gps-remove-btn" (click)="removeGpsLocation()"
                                title="Remove Location">
                                <span class="material-icons">close</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- After Execution Image -->
            <div class="form-section" *ngIf="canShowAfterExecution()">
                <h3>After Execution Image</h3>
                <div class="image-upload-container">
                    <div class="image-preview" *ngIf="afterExecutionImagePreview">
                        <img [src]="afterExecutionImagePreview" alt="After Execution Image">
                        <button type="button" class="remove-btn" (click)="removeImage('after')">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    <div class="upload-area" *ngIf="!afterExecutionImagePreview">
                        <input type="file" id="afterExecutionImage" accept="image/*"
                            (change)="onAfterExecutionImageSelected($event)" class="file-input">
                        <label for="afterExecutionImage" class="upload-label">
                            <span class="material-icons">cloud_upload</span>
                            <span>Upload After Execution Image</span>
                            <!-- <small>JPG, PNG, GIF up to 5MB</small> -->
                        </label>
                    </div>
                </div>
            </div>

            <!-- Notes -->
            <div class="form-section">
                <h3>Notes</h3>
                <div class="form-group">
                    <label for="notes">Additional Notes</label>
                    <textarea id="notes" formControlName="notes" placeholder="Enter any additional notes or comments..."
                        rows="4"></textarea>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <div class="actions-left">
                    <button type="button" class="btn btn-secondary" (click)="goBack()" [disabled]="formLoading">
                        Cancel
                    </button>
                </div>
                <div class="actions-right">
                    <button type="submit" class="btn btn-primary" [disabled]="formLoading || !isFormValid()">
                        <span class="material-icons" *ngIf="!formLoading">save</span>
                        <l-tail-chase *ngIf="formLoading" size="20" speed="1.75" color="white"></l-tail-chase>
                        {{ formLoading ? 'Saving...' : 'Save Changes' }}
                    </button>
                    <!-- <button type="button" class="btn btn-success" (click)="markAsComplete()"
                        [disabled]="formLoading || !canMarkAsComplete()" *ngIf="canMarkAsComplete()">
                        <span class="material-icons">check_circle</span>
                        Mark as Complete
                    </button> -->
                </div>
            </div>
        </form>
    </div>
</div>